"""MCP Server for {{PROJECT_NAME}}

Auto-generated by fastapi-to-mcp Claude Code skill
Generated: {{GENERATION_DATE}}
FastAPI Base URL: {{FASTAPI_BASE_URL}}
"""

import asyncio
import os
from mcp.server.fastmcp import FastMCP
from config import settings
from tools import register_tools


# Initialize MCP server
mcp = FastMCP(
    name=settings.MCP_SERVER_NAME,
    version="1.0.0",
)


@mcp.on_startup()
async def startup():
    """Initialize resources on server startup."""
    print(f"üöÄ {settings.MCP_SERVER_NAME} starting...")
    print(f"üì° Connecting to FastAPI at: {settings.FASTAPI_BASE_URL}")
    print(f"üîß Transport: {settings.MCP_TRANSPORT}")
    # Add any initialization logic here
    # e.g., test FastAPI connection, setup auth, etc.


@mcp.on_shutdown()
async def shutdown():
    """Cleanup resources on server shutdown."""
    print(f"üëã {settings.MCP_SERVER_NAME} shutting down...")
    # Add cleanup logic here


# Register all tools from FastAPI endpoints
register_tools(mcp)


def main():
    """Entry point for MCP server."""
    try:
        # Run server with configured transport
        mcp.run(
            transport=settings.MCP_TRANSPORT,
            **({"port": settings.MCP_PORT} if settings.MCP_TRANSPORT != "stdio" else {})
        )
    except KeyboardInterrupt:
        print("\n‚ö†Ô∏è  Server stopped by user")
    except Exception as e:
        print(f"‚ùå Server error: {e}")
        raise


if __name__ == "__main__":
    main()
