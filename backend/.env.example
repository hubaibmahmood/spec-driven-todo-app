# =============================================================================
# Backend API Environment Variables
# =============================================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Database Configuration (Neon PostgreSQL)
# -----------------------------------------------------------------------------
# Connection string for async PostgreSQL database
# Format: postgresql+asyncpg://user:password@host:port/database
#
# For Docker Compose (use Docker service name 'db' as hostname):
# DATABASE_URL="postgresql+asyncpg://postgres:postgres@db:5432/momentum"
#
# For Neon (production):
# DATABASE_URL="postgresql+asyncpg://username:password@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"
DATABASE_URL=postgresql+asyncpg://username:password@ep-xxx.us-east-2.aws.neon.tech/neondb

# -----------------------------------------------------------------------------
# JWT Authentication Configuration (Hybrid Auth - Spec 013)
# -----------------------------------------------------------------------------
# JWT secret key for signing and verifying tokens (32+ characters)
# CRITICAL: Must match JWT_SECRET in auth-server/.env for token validation
# Generate with: openssl rand -base64 32
JWT_SECRET=generate-a-jwt-secret-key-matching-auth-server

# JWT algorithm (HS256 is HMAC-SHA256)
JWT_ALGORITHM=HS256

# JWT token expiration settings
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# JWT rollout configuration (Phase 7 - Full Migration)
JWT_AUTH_ENABLED=true
JWT_ROLLOUT_PERCENTAGE=100

# Legacy session hash secret (deprecated, kept for backward compatibility)
# Can be removed after full JWT migration
SESSION_HASH_SECRET=legacy-secret-not-used-after-phase7

# -----------------------------------------------------------------------------
# Service-to-Service Authentication
# -----------------------------------------------------------------------------
# Token for authenticating requests from ai-agent microservice
# Must match SERVICE_AUTH_TOKEN in ai-agent/.env and root .env
# Generate with: openssl rand -base64 32
SERVICE_AUTH_TOKEN=your-service-auth-token-change-this

# URL of the auth server (for integration tests and service communication)
# Docker Compose: http://auth-server:3002
# Production: https://auth.yourdomain.com
AUTH_SERVER_URL=http://localhost:3002

# Application Configuration
# Environment: development, staging, production
ENVIRONMENT=development

# CORS Configuration
# Comma-separated list of allowed origins
# Development: http://localhost:3000
# Production: https://yourdomain.com,https://www.yourdomain.com
CORS_ORIGINS=http://localhost:3000

# SQLAlchemy Connection Pool Settings
# Pool size: number of connections to keep open
SQLALCHEMY_POOL_SIZE=10
# Max overflow: additional connections allowed above pool_size
SQLALCHEMY_POOL_OVERFLOW=20
# Pool timeout: seconds to wait for available connection
SQLALCHEMY_POOL_TIMEOUT=30
# Pool recycle: seconds before recycling connections (Neon serverless)
SQLALCHEMY_POOL_RECYCLE=3600
# Echo SQL: log all SQL queries (development only)
SQLALCHEMY_ECHO=false

# -----------------------------------------------------------------------------
# API Key Encryption Configuration (Spec 010)
# -----------------------------------------------------------------------------
# Fernet encryption key for encrypting user API keys at rest
# CRITICAL: Generate a new key for production with the command below
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# Store securely in secrets manager (AWS Secrets Manager, GitHub Secrets, etc.)
ENCRYPTION_KEY=your-fernet-encryption-key-change-this

# -----------------------------------------------------------------------------
# Quick Setup - Auto-Generate All Secrets
# -----------------------------------------------------------------------------
# Run this script from project root to auto-generate all secrets:
#   ./scripts/generate-secrets.sh
#
# This will create .env file with:
#   - BETTER_AUTH_SECRET (root .env)
#   - JWT_SECRET (shared with auth-server)
#   - SERVICE_AUTH_TOKEN (shared across services)
#   - ENCRYPTION_KEY (Fernet key for API key storage)
